var Cs=Object.defineProperty;var Ws=(r,e,t)=>e in r?Cs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var w=(r,e,t)=>(Ws(r,typeof e!="symbol"?e+"":e,t),t),gr=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var n=(r,e,t)=>(gr(r,e,"read from private field"),t?t.call(r):e.get(r)),c=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},l=(r,e,t,s)=>(gr(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var p=(r,e,t)=>(gr(r,e,"access private method"),t);import{E as Ms}from"./base-bflHmD82.js";import{F as $s,E as qs}from"./el-empty-DUeByfxe.js";import{E as Ks,a as js}from"./el-page-header-DSUIZmvO.js";import{E as Gs}from"./el-button-4r8E0DMI.js";import{B as os,a as Hs,S as Ys,N as Xs,b as ee,c as Zs,d as Gr,U as Qs,e as Js,f as ei,R as Vt,A as wr,P as I,W as Z,C as cs,g as Ct,p as jt,h as Q,i as Wt,j as ti,s as Hr,E as We,k as ri}from"./consumable-Dnn1CoAQ.js";import{D as vr}from"./decode-utf8-po1gdrZ2.js";import{W as si,A as ii}from"./wrap-readable-BqHndfMV.js";import{C as ni,E as ai,a as oi}from"./el-menu-item-BoiLbp11.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-Bder4sn0.js";import{d as ls,m as us,U as ci,c as li,o as qt,h as hs,w as A,e as z,f as Er,g as se,u as ui,z as hi,s as di,a as Yr,b as kr,p as fi,C as wi,t as pi,V as gi}from"./index-DpTwNufQ.js";import{E as yi}from"./el-message-BwlTGCWP.js";import"./index-Xv_KeUan.js";import"./typescript-DvA-nEXU.js";import"./aria-BUADUvnR.js";import"./index-DooEso7-.js";const bi={littleEndian:!1};class Cr extends Error{constructor(){super("ExactReadable ended"),Object.setPrototypeOf(this,new.target.prototype)}}const _r=Symbol("struct-value");class Xr{constructor(e){w(this,"fieldValues",{});w(this,"value");this.value=Object.create(e),Object.defineProperty(this.value,_r,{enumerable:!1,value:this})}set(e,t){this.fieldValues[e]=t,t.hasCustomAccessors?Object.defineProperty(this.value,e,{configurable:!0,enumerable:!0,get(){return t.get()},set(s){t.set(s)}}):this.value[e]=t.get()}get(e){return this.fieldValues[e]}}class mi extends os{getSize(){return this.options.length}}class vi extends os{getSize(){return 0}getDeserializeSize(e){let t=e.value[this.options.lengthField];return typeof t=="string"&&(t=Number.parseInt(t,this.options.lengthFieldRadix??10)),t}create(e,t,s,i){return new Ei(this,e,t,s,i)}}class Ei extends Hs{constructor(t,s,i,a,o){super(t,s,i,a,o);w(this,"length");w(this,"lengthFieldValue");o&&(this.length=o.byteLength);const u=this.definition.options.lengthField,h=i.get(u);this.lengthFieldValue=new ki(h,this),i.set(u,this.lengthFieldValue)}getSize(){return this.length===void 0&&(this.length=this.definition.type.getSize(this.value),this.length===-1&&(this.array=this.definition.type.toBuffer(this.value),this.length=this.array.byteLength)),this.length}set(t){super.set(t),this.array=void 0,this.length=void 0}}class ki extends Ys{constructor(t,s){super(t.definition,t.options,t.struct,0);w(this,"originalField");w(this,"bufferField");this.originalField=t,this.bufferField=s}getSize(){return this.originalField.getSize()}get(){let t=this.bufferField.getSize();return typeof this.originalField.get()=="string"&&(t=t.toString(this.bufferField.definition.options.lengthFieldRadix??10)),t}set(){}serialize(t,s){this.originalField.set(this.get()),this.originalField.serialize(t,s)}}class ds extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class _i extends ds{constructor(){super("The underlying readable was ended before the struct was fully deserialized")}}class Wr extends ds{constructor(){super("The underlying readable doesn't contain any more struct")}}var ie,T,ne,ke,B,te,Me,xr,$e;class k{constructor(e){c(this,B);c(this,Me);w(this,"TFields");w(this,"TOmitInitKey");w(this,"TExtra");w(this,"TInit");w(this,"TDeserializeResult");w(this,"options");c(this,ie,0);c(this,T,[]);c(this,ne,{});c(this,ke,void 0);c(this,$e,(e,t,s)=>"length"in s?this.field(e,new mi(t,s)):this.field(e,new vi(t,s)));w(this,"uint8Array",(e,t,s)=>n(this,$e).call(this,e,Qs.Instance,t,s));w(this,"string",(e,t,s)=>n(this,$e).call(this,e,Js.Instance,t,s));this.options={...bi,...e}}get size(){return n(this,ie)}get fields(){return n(this,T)}field(e,t){for(const i of n(this,T))if(i[0]===e){const a=String(e);throw new Error(`This struct already have a field with name '${a}'`)}n(this,T).push([e,t]);const s=t.getSize();return l(this,ie,n(this,ie)+s),this}concat(e){for(const t of n(e,T))n(this,T).push(t);return l(this,ie,n(this,ie)+n(e,ie)),Object.defineProperties(n(this,ne),Object.getOwnPropertyDescriptors(n(e,ne))),this}int8(e,t){return p(this,B,te).call(this,e,ee.Int8,t)}uint8(e,t){return p(this,B,te).call(this,e,ee.Uint8,t)}int16(e,t){return p(this,B,te).call(this,e,ee.Int16,t)}uint16(e,t){return p(this,B,te).call(this,e,ee.Uint16,t)}int32(e,t){return p(this,B,te).call(this,e,ee.Int32,t)}uint32(e,t){return p(this,B,te).call(this,e,ee.Uint32,t)}int64(e,t){return p(this,Me,xr).call(this,e,Gr.Int64,t)}uint64(e,t){return p(this,Me,xr).call(this,e,Gr.Uint64,t)}extra(e){return Object.defineProperties(n(this,ne),Object.getOwnPropertyDescriptors(e)),this}postDeserialize(e){return l(this,ke,e),this}deserialize(e){const t=new Xr(n(this,ne));let s=ei.resolve();const i=e.position;for(const[a,o]of n(this,T))s=s.then(()=>o.deserialize(this.options,e,t)).then(u=>{t.set(a,u)},u=>{throw u instanceof Cr?e.position===i?new Wr:new _i:u});return s.then(()=>{const a=t.value;if(n(this,ke)){const o=n(this,ke).call(a,a);if(o!==void 0)return o}return a}).valueOrPromise()}serialize(e,t){let s;if(_r in e){s=e[_r];for(const[d,y]of Object.entries(e)){const f=s.get(d);f&&f.set(y)}}else{s=new Xr({});for(const[d,y]of n(this,T)){const f=y.create(this.options,s,e[d]);s.set(d,f)}}let i=0;const a=[];for(const[d]of n(this,T)){const y=s.get(d),f=y.getSize();a.push({fieldValue:y,size:f}),i+=f}let o="number";t||(t=new Uint8Array(i),o="Uint8Array");const u=new DataView(t.buffer,t.byteOffset,t.byteLength);let h=0;for(const{fieldValue:d,size:y}of a)d.serialize(u,h),h+=y;return o==="number"?i:t}}ie=new WeakMap,T=new WeakMap,ne=new WeakMap,ke=new WeakMap,B=new WeakSet,te=function(e,t,s){return this.field(e,new Xs(t,s))},Me=new WeakSet,xr=function(e,t,s){return this.field(e,new Zs(t,s))},$e=new WeakMap;function xi(r){return new Promise(function(e){globalThis.setTimeout(function(){return e()},r)})}var _e;class Fe extends Vt{constructor(t,s){let i;const a=new wr;super({start:async o=>{await Promise.resolve();const u=t({abortSignal:a.signal,enqueue:async h=>{if(a.signal.aborted)throw a.signal.reason;if(o.desiredSize===null){o.enqueue(h);return}if(n(this,_e)){l(this,_e,!1),o.enqueue(h);return}o.desiredSize<=0&&(i=new I,await i.promise),o.enqueue(h)},close(){o.close()},error(h){o.error(h)}});u&&"then"in u&&u.then(()=>{try{o.close()}catch{}},h=>{o.error(h)})},pull:()=>{if(i){i.resolve();return}(s==null?void 0:s.highWaterMark)===0&&l(this,_e,!0)},cancel:o=>{a.abort(o),i==null||i.reject(o)}},s);c(this,_e,!1)}}_e=new WeakMap;const Si=()=>{};var U,V,C,L,qe,Sr,Ke,Lr;class pr{constructor(e){c(this,qe);c(this,Ke);c(this,U,void 0);c(this,V,0);c(this,C,0);c(this,L,0);w(this,"stream");w(this,"reader");this.stream=e,this.reader=e.getReader()}get position(){return n(this,L)}readExactly(e){if(n(this,U)){const t=n(this,U),s=n(this,V);return n(this,C)>e?(l(this,V,n(this,V)+e),l(this,C,n(this,C)-e),l(this,L,n(this,L)+e),t.subarray(s,s+e)):(l(this,U,void 0),l(this,C,0),l(this,V,0),l(this,L,n(this,L)+(t.length-s)),p(this,Ke,Lr).call(this,e,t.subarray(s)))}return p(this,Ke,Lr).call(this,e)}release(){return n(this,C)>0?new Fe(async e=>{const t=n(this,U).subarray(n(this,V));for(await e.enqueue(t),e.abortSignal.addEventListener("abort",()=>{this.reader.cancel().catch(Si)});;){const{done:s,value:i}=await this.reader.read();if(s)return;await e.enqueue(i)}}):(this.reader.releaseLock(),this.stream)}async cancel(e){await this.reader.cancel(e)}}U=new WeakMap,V=new WeakMap,C=new WeakMap,L=new WeakMap,qe=new WeakSet,Sr=async function(){const{done:e,value:t}=await this.reader.read();if(e)throw new Cr;return t},Ke=new WeakSet,Lr=async function(e,t){let s,i;if(t)s=new Uint8Array(e),s.set(t),i=t.length,e-=t.length;else{const a=await p(this,qe,Sr).call(this);if(a.length===e)return l(this,L,n(this,L)+e),a;if(a.length>e)return l(this,U,a),l(this,V,e),l(this,C,a.length-e),l(this,L,n(this,L)+e),a.subarray(0,e);s=new Uint8Array(e),s.set(a),i=a.length,e-=a.length,l(this,L,n(this,L)+a.length)}for(;e>0;){const a=await p(this,qe,Sr).call(this);if(a.length===e)return s.set(a,i),l(this,L,n(this,L)+e),s;if(a.length>e)return l(this,U,a),l(this,V,e),l(this,C,a.length-e),s.set(a.subarray(0,e),i),l(this,L,n(this,L)+e),s;s.set(a,i),i+=a.length,e-=a.length,l(this,L,n(this,L)+a.length)}return s};var je,Ge;class Li{constructor(e){c(this,je,void 0);c(this,Ge,void 0);let t;const s=new pr(new Fe(i=>{t=i}));l(this,je,new Vt({async pull(i){try{const a=await e(s);i.enqueue(a)}catch(a){if(a instanceof Wr){i.close();return}throw a}},cancel:i=>s.cancel(i)})),l(this,Ge,new Z({async write(i){await t.enqueue(i)},abort(){t.close()},close(){t.close()}}))}get readable(){return n(this,je)}get writable(){return n(this,Ge)}}je=new WeakMap,Ge=new WeakMap;var xe,N,tr,ae,He;class Dr{constructor(){c(this,xe,"");c(this,N,new I);c(this,tr,new Z({write:e=>{l(this,xe,n(this,xe)+e)},close:()=>{n(this,N).resolve(n(this,xe)),n(this,ae).enqueue(n(this,xe)),n(this,ae).close()},abort:e=>{n(this,N).reject(e),n(this,ae).error(e)}}));c(this,ae,void 0);c(this,He,new Vt({start:e=>{l(this,ae,e)}}));Object.defineProperties(n(this,He),{then:{get:()=>n(this,N).promise.then.bind(n(this,N).promise)},catch:{get:()=>n(this,N).promise.catch.bind(n(this,N).promise)},finally:{get:()=>n(this,N).promise.finally.bind(n(this,N).promise)}})}get writable(){return n(this,tr)}get readable(){return n(this,He)}}xe=new WeakMap,N=new WeakMap,tr=new WeakMap,ae=new WeakMap,He=new WeakMap;var W,M,_,D;class fs{constructor(e){c(this,W,void 0);c(this,M,void 0);c(this,_,void 0);c(this,D,void 0);l(this,W,e),l(this,M,new Uint8Array(e)),l(this,_,0),l(this,D,e)}*push(e){let t=0,s=e.byteLength;if(n(this,_)!==0)if(s>=n(this,D)){if(n(this,M).set(e.subarray(0,n(this,D)),n(this,_)),t+=n(this,D),s-=n(this,D),yield n(this,M),l(this,_,0),l(this,D,n(this,W)),s===0)return}else{n(this,M).set(e,n(this,_)),l(this,_,n(this,_)+s),l(this,D,n(this,D)-s);return}for(;s>=n(this,W);){const i=t+n(this,W);yield e.subarray(t,i),t=i,s-=n(this,W)}s>0&&(n(this,M).set(e.subarray(t),n(this,_)),l(this,_,n(this,_)+s),l(this,D,n(this,D)-s))}flush(){if(n(this,_)===0)return;const e=n(this,M).subarray(0,n(this,_));return l(this,_,0),l(this,D,n(this,W)),e}}W=new WeakMap,M=new WeakMap,_=new WeakMap,D=new WeakMap;class Di extends cs{constructor(e,t=!1){const s=t?new fs(e):void 0;super({async transform(i,a){if(s)for(const o of s.push(i))await a.enqueue(o);else{let o=0,u=i.byteLength;for(;u>0;){const h=o+e;await a.enqueue(i.subarray(o,h)),o=h,u-=e}}},async flush(i){if(s){const a=s.flush();a&&await i.enqueue(a)}}})}}const Zr=()=>{};var Ye,Xe,oe,Ze,Se;class Oi{constructor(e){c(this,Ye,[]);c(this,Xe,[]);c(this,oe,!1);c(this,Ze,new I);c(this,Se,void 0);l(this,Se,e??{})}get writableClosed(){return n(this,oe)}get closed(){return n(this,Ze).promise}wrapReadable(e,t){return new si({start:s=>(n(this,Ye).push(s),e),cancel:async()=>{await this.close()},close:async()=>{await this.dispose()}},t)}createWritable(e){const t=e.getWriter();return n(this,Xe).push(t),new Z({write:async s=>{await t.write(s)},abort:async s=>{await t.abort(s),await this.close()},close:async()=>{await t.close().catch(Zr),await this.close()}})}async close(){var e,t;if(!n(this,oe)){l(this,oe,!0),await((t=(e=n(this,Se)).close)==null?void 0:t.call(e))!==!1&&await this.dispose();for(const s of n(this,Xe))s.close().catch(Zr)}}async dispose(){var e,t;l(this,oe,!0),n(this,Ze).resolve();for(const s of n(this,Ye))try{s.close()}catch{}await((t=(e=n(this,Se)).dispose)==null?void 0:t.call(e))}}Ye=new WeakMap,Xe=new WeakMap,oe=new WeakMap,Ze=new WeakMap,Se=new WeakMap;function Ti(r,e){const t=e.writable.getWriter(),s=e.readable.pipeTo(r);return new Z({async write(i){await t.write(i)},async close(){await t.close(),await s}})}class Ni extends Li{constructor(e){super(t=>e.deserialize(t))}}var Le;class Mr{constructor(){c(this,Le,[]);this.dispose=this.dispose.bind(this)}addDisposable(e){return n(this,Le).push(e),e}dispose(){for(const e of n(this,Le))e.dispose();l(this,Le,[])}}Le=new WeakMap;class $r extends Mr{constructor(t){super();w(this,"adb");this.adb=t}}const Pi=new k({littleEndian:!0}).uint32("version"),Ri=new k({littleEndian:!0}).uint32("bpp").uint32("size").uint32("width").uint32("height").uint32("red_offset").uint32("red_length").uint32("blue_offset").uint32("blue_length").uint32("green_offset").uint32("green_length").uint32("alpha_offset").uint32("alpha_length").uint8Array("data",{lengthField:"size"}),zi=new k({littleEndian:!0}).uint32("bpp").uint32("colorSpace").uint32("size").uint32("width").uint32("height").uint32("red_offset").uint32("red_length").uint32("blue_offset").uint32("blue_length").uint32("green_offset").uint32("green_length").uint32("alpha_offset").uint32("alpha_length").uint8Array("data",{lengthField:"size"});class ws extends Error{constructor(e,t){super(e,t)}}class Ii extends ws{constructor(e){super(`Unsupported FrameBuffer version ${e}`)}}class Ai extends ws{constructor(){super("FrameBuffer is disabled by current app")}}async function Fi(r){const e=await r.createSocket("framebuffer:"),t=new pr(e.readable);let s;try{({version:s}=await Pi.deserialize(t))}catch(i){throw i instanceof Wr?new Ai:i}switch(s){case 1:return Ri.deserialize(t);case 2:return zi.deserialize(t);default:throw new Ii(s)}}class Bi extends $r{reboot(e=""){return this.adb.createSocketAndWait(`reboot:${e}`)}bootloader(){return this.reboot("bootloader")}fastboot(){return this.reboot("fastboot")}recovery(){return this.reboot("recovery")}sideload(){return this.reboot("sideload")}qualcommEdlMode(){return this.reboot("edl")}powerOff(){return this.adb.subprocess.spawnAndWaitLegacy(["reboot","-p"])}powerButton(e=!1){return this.adb.subprocess.spawnAndWaitLegacy(["input","keyevent",e?"--longpress POWER":"POWER"])}samsungOdin(){return this.reboot("download")}}var ce,$;class ps{constructor(e=!1){c(this,ce,void 0);c(this,$,[]);l(this,ce,e)}wait(){if(!n(this,ce)&&(l(this,ce,!0),n(this,$).length===0))return Promise.resolve();const e=new I;return n(this,$).push(e),e.promise}notifyOne(){n(this,$).length!==0?n(this,$).pop().resolve():l(this,ce,!1)}dispose(){for(const e of n(this,$))e.reject(new Error("The AutoResetEvent has been disposed"));n(this,$).length=0}}ce=new WeakMap,$=new WeakMap;const m=[],Ee=61;function Mt(r,e){const t=r.charCodeAt(0),s=e.charCodeAt(0);for(let i=t;i<=s;i+=1)m.push(i)}Mt("A","Z");Mt("a","z");Mt("0","9");Mt("+","+");Mt("/","/");function gs(r){const e=r%3,t=e!==0?3-e:0;return[(r+t)/3*4,t]}function Ui(r,e){const[t,s]=gs(r.length);if(e){if(e.length<t)throw new Error("output buffer is too small");if(e=e.subarray(0,t),r.buffer!==e.buffer)yr(r,e,s);else if(e.byteOffset+e.length-(s+1)<=r.byteOffset+r.length)yr(r,e,s);else if(e.byteOffset>=r.byteOffset-1)Vi(r,e,s);else throw new Error("input and output cannot overlap");return t}else return e=new Uint8Array(t),yr(r,e,s),e}function yr(r,e,t){let s=0,i=0;for(;s<r.length-2;){const a=r[s];s+=1;const o=r[s];s+=1;const u=r[s];s+=1,e[i]=m[a>>2],i+=1,e[i]=m[(a&3)<<4|o>>4],i+=1,e[i]=m[(o&15)<<2|u>>6],i+=1,e[i]=m[u&63],i+=1}if(t===2){const a=r[s];s+=1,e[i]=m[a>>2],i+=1,e[i]=m[(a&3)<<4],i+=1,e[i]=Ee,i+=1,e[i]=Ee}else if(t===1){const a=r[s];s+=1;const o=r[s];s+=1,e[i]=m[a>>2],i+=1,e[i]=m[(a&3)<<4|o>>4],i+=1,e[i]=m[(o&15)<<2],i+=1,e[i]=Ee}}function Vi(r,e,t){let s=r.length-1,i=e.length-1;if(t===2){const a=r[s];s-=1,e[i]=Ee,i-=1,e[i]=Ee,i-=1,e[i]=m[(a&3)<<4],i-=1,e[i]=m[a>>2],i-=1}else if(t===1){const a=r[s];s-=1;const o=r[s];s-=1,e[i]=Ee,i-=1,e[i]=m[(a&15)<<2],i-=1,e[i]=m[(o&3)<<4|a>>4],i-=1,e[i]=m[o>>2],i-=1}for(;s>=0;){const a=r[s];s-=1;const o=r[s];s-=1;const u=r[s];s-=1,e[i]=m[a&63],i-=1,e[i]=m[(o&15)<<2|a>>6],i-=1,e[i]=m[(u&3)<<4|o>>4],i-=1,e[i]=m[u>>2],i-=1}}function Ci(r){if(r<48)throw new Error(`Invalid hex char ${r}`);if(r<58)return r-48;if(r<65)throw new Error(`Invalid hex char ${r}`);if(r<71)return r-55;if(r<97)throw new Error(`Invalid hex char ${r}`);if(r<103)return r-87;throw new Error(`Invalid hex char ${r}`)}function Wi(r){let e=0;for(let t=0;t<r.length;t+=1)e=e<<4|Ci(r[t]);return e}const Mi=()=>{};function ys(...r){throw new Error(`Unreachable. Arguments:
`+r.join(`
`))}const bs=new k().string("length",{length:4}).string("content",{lengthField:"length",lengthFieldRadix:16});class ms extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class $i extends ms{constructor(){super("ADB reverse tunnel is not supported on this device when connected wirelessly.")}}const qi=new k().concat(bs).postDeserialize(r=>{throw r.content==="more than one device/emulator"?new $i:new ms(r.content)});async function Qr(r,e){const t=await r.readExactly(e);return Ct(t)}var De;class Ki extends Mr{constructor(t){super();w(this,"adb");c(this,De,new Map);this.adb=t}async createBufferedStream(t){const s=await this.adb.createSocket(t);return new pr(s.readable)}async sendRequest(t){const s=await this.createBufferedStream(t);return await Qr(s,4)==="OKAY"||await qi.deserialize(s),s}async list(){const t=await this.createBufferedStream("reverse:list-forward");return(await bs.deserialize(t)).content.split(`
`).map(i=>{const[a,o,u]=i.split(" ");return{deviceSerial:a,localName:o,remoteName:u}})}async addExternal(t,s){const i=await this.sendRequest(`reverse:forward:${t};${s}`);if(t.startsWith("tcp:")){const a=i.position;try{const o=Wi(await i.readExactly(4)),u=await Qr(i,o);t=`tcp:${Number.parseInt(u,10)}`}catch(o){if(!(o instanceof Cr&&i.position===a))throw o}}return t}async add(t,s,i){i=await this.adb.transport.addReverseTunnel(s,i);try{return t=await this.addExternal(t,i),n(this,De).set(t,i),t}catch(a){throw await this.adb.transport.removeReverseTunnel(i),a}}async remove(t){const s=n(this,De).get(t);s&&await this.adb.transport.removeReverseTunnel(s),await this.sendRequest(`reverse:killforward:${t}`)}async removeAll(){await this.adb.transport.clearReverseTunnels(),n(this,De).clear(),await this.sendRequest("reverse:killforward-all")}}De=new WeakMap;var q,Qe,Je;const rr=class rr{constructor(e){c(this,q,void 0);c(this,Qe,void 0);c(this,Je,void 0);l(this,q,e),l(this,Qe,new Vt({start:t=>{n(this,q).closed.then(()=>t.close()).catch(ys)}})),l(this,Je,e.closed.then(()=>0))}static isSupported(){return!0}static async pty(e,t){return new rr(await e.createSocket(`shell:${t}`))}static async raw(e,t){return new rr(await e.createSocket(`exec:${t}`))}get stdin(){return n(this,q).writable}get stdout(){return n(this,q).readable}get stderr(){return n(this,Qe)}get exit(){return n(this,Je)}resize(){}async kill(){await n(this,q).close()}};q=new WeakMap,Qe=new WeakMap,Je=new WeakMap;let Gt=rr;var g;(function(r){r.ShellV2="shell_v2",r.Cmd="cmd",r.StatV2="stat_v2",r.ListV2="ls_v2",r.FixedPushMkdir="fixed_push_mkdir",r.Abb="abb",r.AbbExec="abb_exec",r.SendReceiveV2="sendrecv_v2",r.DelayedAck="delayed_ack"})(g||(g={}));var re;(function(r){r[r.Stdin=0]="Stdin",r[r.Stdout=1]="Stdout",r[r.Stderr=2]="Stderr",r[r.Exit=3]="Exit",r[r.CloseStdin=4]="CloseStdin",r[r.WindowSizeChange=5]="WindowSizeChange"})(re||(re={}));const br=new k({littleEndian:!0}).uint8("id",jt()).uint32("length").uint8Array("data",{lengthField:"length"});var Oe,Te,et,tt,rt,le;const sr=class sr{constructor(e){c(this,Oe,void 0);c(this,Te,void 0);c(this,et,void 0);c(this,tt,void 0);c(this,rt,void 0);c(this,le,new I);l(this,Oe,e);let t,s;l(this,tt,new Fe(i=>{t=i})),l(this,rt,new Fe(i=>{s=i})),e.readable.pipeThrough(new Ni(br)).pipeTo(new Z({write:async i=>{switch(i.id){case re.Exit:n(this,le).resolve(i.data[0]);break;case re.Stdout:t.abortSignal.aborted||await t.enqueue(i.data);break;case re.Stderr:s.abortSignal.aborted||await s.enqueue(i.data);break}}})).then(()=>{t.close(),s.close(),n(this,le).reject(new Error("Socket ended without exit message"))},i=>{t.error(i),s.error(i),n(this,le).reject(i)}),l(this,Te,n(this,Oe).writable.getWriter()),l(this,et,new Z({write:async i=>{await Q.write(n(this,Te),br.serialize({id:re.Stdin,data:i.value})),i.consume()}}))}static isSupported(e){return e.canUseFeature(g.ShellV2)}static async pty(e,t){return new sr(await e.createSocket(`shell,v2,pty:${t}`))}static async raw(e,t){return new sr(await e.createSocket(`shell,v2,raw:${t}`))}get stdin(){return n(this,et)}get stdout(){return n(this,tt)}get stderr(){return n(this,rt)}get exit(){return n(this,le).promise}async resize(e,t){await Q.write(n(this,Te),br.serialize({id:re.WindowSizeChange,data:Wt(`${e}x${t},0x0\0`)}))}kill(){return n(this,Oe).close()}};Oe=new WeakMap,Te=new WeakMap,et=new WeakMap,tt=new WeakMap,rt=new WeakMap,le=new WeakMap;let Or=sr;const ji={protocols:[Or,Gt]};var st,Tr;class Gi extends $r{constructor(){super(...arguments);c(this,st)}shell(t,s){return p(this,st,Tr).call(this,"pty",t,s)}spawn(t,s){return p(this,st,Tr).call(this,"raw",t,s)}async spawnAndWait(t,s){const i=await this.spawn(t,s),[a,o,u]=await Promise.all([i.stdout.pipeThrough(new vr).pipeThrough(new Dr),i.stderr.pipeThrough(new vr).pipeThrough(new Dr),i.exit]);return{stdout:a,stderr:o,exitCode:u}}async spawnAndWaitLegacy(t){const{stdout:s}=await this.spawnAndWait(t,{protocols:[Gt]});return s}}st=new WeakSet,Tr=async function(t,s,i){const{protocols:a}={...ji,...i};let o;for(const u of a)if(await u.isSupported(this.adb)){o=u;break}if(!o)throw new Error("No specified protocol is supported by the device");return Array.isArray(s)?s=s.join(" "):s===void 0&&(s=""),await o[t](this.adb,s)};function Nr(r){let e="";e+="'";let t=0;for(;;){const s=r.indexOf("'",t);if(s===-1){e+=r.substring(t);break}e+=r.substring(t,s),e+=String.raw`'\''`,t=s+1}return e+="'",e}var S;(function(r){r.List="LIST",r.ListV2="LIS2",r.Send="SEND",r.SendV2="SND2",r.Lstat="STAT",r.Stat="STA2",r.LstatV2="LST2",r.Data="DATA",r.Done="DONE",r.Receive="RECV"})(S||(S={}));const Kt=new k({littleEndian:!0}).string("id",{length:4}).uint32("arg");new k({littleEndian:!0}).concat(Kt).uint8Array("data",{lengthField:"arg"});async function F(r,e,t){if(typeof t=="number"){const s=Kt.serialize({id:e,arg:t});await r.write(s)}else if(typeof t=="string"){const s=Wt(t);await r.write(Kt.serialize({id:e,arg:s.byteLength})),await r.write(s)}else await r.write(Kt.serialize({id:e,arg:t.byteLength})),await r.write(t)}var v;(function(r){r.Entry="DENT",r.Entry2="DNT2",r.Lstat="STAT",r.Stat="STA2",r.Lstat2="LST2",r.Done="DONE",r.Data="DATA",r.Ok="OKAY",r.Fail="FAIL"})(v||(v={}));class Hi extends Error{}const vs=new k({littleEndian:!0}).uint32("messageLength").string("message",{lengthField:"messageLength"}).postDeserialize(r=>{throw new Hi(r.message)});async function Ht(r,e,t){const s=Ct(await r.readExactly(4));switch(s){case v.Fail:throw await vs.deserialize(r),new Error("Unreachable");case e:return await t.deserialize(r);default:throw new Error(`Expected '${e}', but got '${s}'`)}}async function*Yt(r,e,t){for(;;){const s=Ct(await r.readExactly(4));switch(s){case v.Fail:throw await vs.deserialize(r),new Error("Unreachable");case v.Done:await r.readExactly(t.size);return;case e:yield await t.deserialize(r);break;default:throw new Error(`Expected '${e}' or '${v.Done}', but got '${s}'`)}}}var Xt;(function(r){r[r.Directory=4]="Directory",r[r.File=8]="File",r[r.Link=10]="Link"})(Xt||(Xt={}));const Es=new k({littleEndian:!0}).int32("mode").int32("size").int32("mtime").extra({id:v.Lstat,get type(){return this.mode>>12},get permission(){return this.mode&4095}}).postDeserialize(r=>{if(r.mode===0&&r.size===0&&r.mtime===0)throw new Error("lstat error")});var Zt;(function(r){r[r.SUCCESS=0]="SUCCESS",r[r.EACCES=13]="EACCES",r[r.EEXIST=17]="EEXIST",r[r.EFAULT=14]="EFAULT",r[r.EFBIG=27]="EFBIG",r[r.EINTR=4]="EINTR",r[r.EINVAL=22]="EINVAL",r[r.EIO=5]="EIO",r[r.EISDIR=21]="EISDIR",r[r.ELOOP=40]="ELOOP",r[r.EMFILE=24]="EMFILE",r[r.ENAMETOOLONG=36]="ENAMETOOLONG",r[r.ENFILE=23]="ENFILE",r[r.ENOENT=2]="ENOENT",r[r.ENOMEM=12]="ENOMEM",r[r.ENOSPC=28]="ENOSPC",r[r.ENOTDIR=20]="ENOTDIR",r[r.EOVERFLOW=75]="EOVERFLOW",r[r.EPERM=1]="EPERM",r[r.EROFS=30]="EROFS",r[r.ETXTBSY=26]="ETXTBSY"})(Zt||(Zt={}));const qr=new k({littleEndian:!0}).uint32("error",jt()).uint64("dev").uint64("ino").uint32("mode").uint32("nlink").uint32("uid").uint32("gid").uint64("size").uint64("atime").uint64("mtime").uint64("ctime").extra({id:v.Stat,get type(){return this.mode>>12},get permission(){return this.mode&4095}}).postDeserialize(r=>{if(r.error)throw new Error(Zt[r.error])});async function Yi(r,e,t){const s=await r.lock();try{if(t)return await F(s,S.LstatV2,e),await Ht(s,v.Lstat2,qr);{await F(s,S.Lstat,e);const i=await Ht(s,v.Lstat,Es);return{mode:i.mode,size:BigInt(i.size),mtime:BigInt(i.mtime),get type(){return i.type},get permission(){return i.permission}}}}finally{s.release()}}async function Xi(r,e){const t=await r.lock();try{return await F(t,S.Stat,e),await Ht(t,v.Stat,qr)}finally{t.release()}}const Zi=new k({littleEndian:!0}).concat(Es).uint32("nameLength").string("name",{lengthField:"nameLength"}).extra({id:v.Entry}),Qi=new k({littleEndian:!0}).concat(qr).uint32("nameLength").string("name",{lengthField:"nameLength"}).extra({id:v.Entry2});async function*Ji(r,e){const t=await r.lock();try{await F(t,S.ListV2,e);for await(const s of Yt(t,v.Entry2,Qi))s.error===Zt.SUCCESS&&(yield s)}finally{t.release()}}async function*en(r,e){const t=await r.lock();try{await F(t,S.List,e);for await(const s of Yt(t,v.Entry,Zi))yield s}finally{t.release()}}async function*tn(r,e,t){if(t)yield*Ji(r,e);else for await(const s of en(r,e))yield{mode:s.mode,size:BigInt(s.size),mtime:BigInt(s.mtime),get type(){return s.type},get permission(){return s.permission},name:s.name}}const Jr=new k({littleEndian:!0}).uint32("dataLength").uint8Array("data",{lengthField:"dataLength"}).extra({id:v.Data});async function*rn(r,e){const t=await r.lock();let s=!1;try{await F(t,S.Receive,e);for await(const i of Yt(t,v.Data,Jr))yield i.data;s=!0}catch(i){throw s=!0,i}finally{if(!s)for await(const i of Yt(t,v.Data,Jr));t.release()}}function sn(r,e){return new Fe(async t=>{for await(const s of rn(r,e))await t.enqueue(s)})}const ks=64*1024,nn=new k({littleEndian:!0}).uint32("unused");async function _s(r,e,t,s){const i=new wr;e.pipeThrough(new Di(t,!0)).pipeTo(new Q({write:async a=>{await F(r,S.Data,a)}}),{signal:i.signal}).then(async()=>{await F(r,S.Done,s),await r.flush()},Mi),await Ht(r,v.Ok,nn).catch(a=>{throw i.abort(),a})}async function an({socket:r,filename:e,file:t,type:s=Xt.File,permission:i=438,mtime:a=Date.now()/1e3|0,packetSize:o=ks}){const u=await r.lock();try{const h=s<<12|i,d=`${e},${h.toString()}`;await F(u,S.Send,d),await _s(u,t,o,a)}finally{u.release()}}var Qt;(function(r){r[r.None=0]="None",r[r.Brotli=1]="Brotli",r[r.Lz4=2]="Lz4",r[r.Zstd=4]="Zstd",r[r.DryRun=2147483648]="DryRun"})(Qt||(Qt={}));const on=new k({littleEndian:!0}).uint32("id",jt()).uint32("mode").uint32("flags",jt());async function cn({socket:r,filename:e,file:t,type:s=Xt.File,permission:i=438,mtime:a=Date.now()/1e3|0,packetSize:o=ks,dryRun:u=!1}){const h=await r.lock();try{await F(h,S.SendV2,e);const d=s<<12|i;let y=Qt.None;u&&(y|=Qt.DryRun),await h.write(on.serialize({id:S.SendV2,mode:d,flags:y})),await _s(h,t,o,a)}finally{h.release()}}function ln(r){if(r.v2)return cn(r);if(r.dryRun)throw new Error("dryRun is not supported in v1");return an(r)}var it,ue,nt,he,de,at,Pr;class un{constructor(e,t,s,i){c(this,at);c(this,it,void 0);c(this,ue,void 0);c(this,nt,void 0);c(this,he,new ps);c(this,de,void 0);l(this,it,e),l(this,ue,t),l(this,nt,i),l(this,de,new fs(s))}get position(){return n(this,ue).position}async flush(){try{await n(this,he).wait();const e=n(this,de).flush();e&&await p(this,at,Pr).call(this,e)}finally{n(this,he).notifyOne()}}async write(e){try{await n(this,he).wait();for(const t of n(this,de).push(e))await p(this,at,Pr).call(this,t)}finally{n(this,he).notifyOne()}}async readExactly(e){return await this.flush(),await n(this,ue).readExactly(e)}release(){n(this,de).flush(),n(this,nt).notifyOne()}async close(){await n(this,ue).cancel()}}it=new WeakMap,ue=new WeakMap,nt=new WeakMap,he=new WeakMap,de=new WeakMap,at=new WeakSet,Pr=async function(e){await Q.write(n(this,it),e)};var ot,ct,Ne;class hn{constructor(e,t){c(this,ot,new ps);c(this,ct,void 0);c(this,Ne,void 0);l(this,ct,e),l(this,Ne,new un(e.writable.getWriter(),new pr(e.readable),t,n(this,ot)))}async lock(){return await n(this,ot).wait(),n(this,Ne)}async close(){await n(this,Ne).close(),await n(this,ct).close()}}ot=new WeakMap,ct=new WeakMap,Ne=new WeakMap;function dn(r){const e=r.lastIndexOf("/");if(e===-1)throw new Error("Invalid path");return e===0?"/":r.substring(0,e)}var fe,lt,ut,ht,dt;class fn extends Mr{constructor(t,s){super();w(this,"_adb");w(this,"_socket");c(this,fe,void 0);c(this,lt,void 0);c(this,ut,void 0);c(this,ht,void 0);c(this,dt,void 0);this._adb=t,this._socket=new hn(s,t.maxPayloadSize),l(this,fe,t.canUseFeature(g.StatV2)),l(this,lt,t.canUseFeature(g.ListV2)),l(this,ut,t.canUseFeature(g.FixedPushMkdir)),l(this,ht,t.canUseFeature(g.SendReceiveV2)),l(this,dt,this._adb.canUseFeature(g.ShellV2)&&!this.fixedPushMkdir)}get supportsStat(){return n(this,fe)}get supportsListV2(){return n(this,lt)}get fixedPushMkdir(){return n(this,ut)}get supportsSendReceiveV2(){return n(this,ht)}get needPushMkdirWorkaround(){return n(this,dt)}async lstat(t){return await Yi(this._socket,t,n(this,fe))}async stat(t){if(!n(this,fe))throw new Error("Not supported");return await Xi(this._socket,t)}async isDirectory(t){try{return await this.lstat(t+"/"),!0}catch{return!1}}opendir(t){return tn(this._socket,t,this.supportsListV2)}async readdir(t){const s=[];for await(const i of this.opendir(t))s.push(i);return s}read(t){return sn(this._socket,t)}async write(t){this.needPushMkdirWorkaround&&await this._adb.subprocess.spawnAndWait(["mkdir","-p",Nr(dn(t.filename))]),await ln({v2:this.supportsSendReceiveV2,socket:this._socket,...t})}async dispose(){super.dispose(),await this._socket.close()}}fe=new WeakMap,lt=new WeakMap,ut=new WeakMap,ht=new WeakMap,dt=new WeakMap;var ft,Rr;class wn extends $r{constructor(){super(...arguments);c(this,ft)}async getListenAddresses(){const t=await this.adb.getProp("service.adb.listen_addrs"),s=await this.adb.getProp("service.adb.tcp.port"),i=await this.adb.getProp("persist.adb.tcp.port");return{serviceListenAddresses:t!=""?t.split(","):[],servicePort:p(this,ft,Rr).call(this,s),persistPort:p(this,ft,Rr).call(this,i)}}async setPort(t){if(t<=0)throw new Error(`Invalid port ${t}`);const s=await this.adb.createSocketAndWait(`tcpip:${t}`);if(s!==`restarting in TCP mode port: ${t}
`)throw new Error(s);return s}async disable(){const t=await this.adb.createSocketAndWait("usb:");if(t!==`restarting in USB mode
`)throw new Error(t);return t}}ft=new WeakSet,Rr=function(t){if(!(!t||t==="0"))return Number.parseInt(t,10)};class pn{constructor(e){w(this,"transport");w(this,"subprocess");w(this,"power");w(this,"reverse");w(this,"tcpip");this.transport=e,this.subprocess=new Gi(this),this.power=new Bi(this),this.reverse=new Ki(this),this.tcpip=new wn(this)}get serial(){return this.transport.serial}get maxPayloadSize(){return this.transport.maxPayloadSize}get banner(){return this.transport.banner}get disconnected(){return this.transport.disconnected}get clientFeatures(){return this.transport.clientFeatures}get deviceFeatures(){return this.banner.features}canUseFeature(e){return this.clientFeatures.includes(e)&&this.deviceFeatures.includes(e)}async createSocket(e){return this.transport.connect(e)}async createSocketAndWait(e){return await(await this.createSocket(e)).readable.pipeThrough(new vr).pipeThrough(new Dr)}async getProp(e){return(await this.subprocess.spawnAndWaitLegacy(["getprop",e])).trim()}async rm(e,t){const s=["rm"];if(t!=null&&t.recursive&&s.push("-r"),t!=null&&t.force&&s.push("-f"),Array.isArray(e))for(const a of e)s.push(Nr(a));else s.push(Nr(e));return s.push("</dev/null"),await this.subprocess.spawnAndWaitLegacy(s)}async sync(){const e=await this.createSocket("sync:");return new fn(this,e)}async framebuffer(){return Fi(this)}async close(){await this.transport.close()}}var ve;(function(r){r.Product="ro.product.name",r.Model="ro.product.model",r.Device="ro.product.device",r.Features="features"})(ve||(ve={}));var wt,pt,gt,yt;const Kr=class Kr{constructor(e,t,s,i){c(this,wt,void 0);c(this,pt,void 0);c(this,gt,void 0);c(this,yt,[]);l(this,wt,e),l(this,pt,t),l(this,gt,s),l(this,yt,i)}static parse(e){let t,s,i,a=[];const o=e.split("::");if(o.length>1){const u=o[1];for(const h of u.split(";")){if(!h)continue;const d=h.split("=");if(d.length!==2)continue;const[y,f]=d;switch(y){case ve.Product:t=f;break;case ve.Model:s=f;break;case ve.Device:i=f;break;case ve.Features:a=f.split(",");break}}}return new Kr(t,s,i,a)}get product(){return n(this,wt)}get model(){return n(this,pt)}get device(){return n(this,gt)}get features(){return n(this,yt)}};wt=new WeakMap,pt=new WeakMap,gt=new WeakMap,yt=new WeakMap;let zr=Kr;function Ir(r,e,t){let s=0n;for(let i=e;i<e+t;i+=8){s<<=64n;const a=ti(r,i,!1);s+=a}return s}function Ar(r,e,t,s){const i=e;if(s)for(;t>0n;)Hr(r,e,t,!0),e+=8,t>>=64n;else{const a=[];for(;t>0n;)a.push(BigInt.asUintN(64,t)),t>>=64n;for(let o=a.length-1;o>=0;o-=1)Hr(r,e,a[o],!1),e+=8}return e-i}const gn=38,yn=2048/8,bn=303,mn=2048/8;function xs(r){const e=new DataView(r.buffer,r.byteOffset,r.byteLength),t=Ir(e,gn,yn),s=Ir(e,bn,mn);return[t,s]}function vn(r,e){if(r=(r%e+e)%e,!r||e<2)return NaN;const t=[];let s=e;for(;s;)[r,s]=[s,r%s],t.push({a:r,b:s});if(r!==1)return NaN;let i=1,a=0;for(let o=t.length-2;o>=0;o-=1)[i,a]=[a,i-a*Math.floor(t[o].a/t[o].b)];return(a%e+e)%e}function Ss(){return 8+2048/8+2048/8+4}function En(r,e){let t;const s=Ss();if(!e)e=new Uint8Array(s),t="Uint8Array";else{if(e.byteLength<s)throw new Error("output buffer is too small");t="number"}const i=new DataView(e.buffer,e.byteOffset,e.byteLength);let a=0;i.setUint32(a,2048/8/4,!0),a+=4;const[o]=xs(r),u=vn(-Number(BigInt.asUintN(32,o)),2**32);i.setUint32(a,u,!0),a+=4,Ar(i,a,o,!0),a+=256;const h=2n**4096n%o;return a+=Ar(i,a,h,!0),i.setUint32(a,65537,!0),a+=4,t==="Uint8Array"?e:s}function kn(r,e,t){if(t===1n)return 0n;let s=1n;for(r=r%t;e>0n;)BigInt.asUintN(1,e)===1n&&(s=s*r%t),r=r*r%t,e>>=1n;return s}const es=20,ts=48,_n=4,xn=5,Sn=6,mr=new Uint8Array([ts,13+es,ts,9,Sn,5,1*40+3,14,3,2,26,xn,0,_n,es]);function Ln(r,e){const[t,s]=xs(r),i=new Uint8Array(256);let a=0;i[a]=0,a+=1,i[a]=1,a+=1;const o=i.length-mr.length-e.length-1;for(;a<o;)i[a]=255,a+=1;i[a]=0,a+=1,i.set(mr,a),a+=mr.length,i.set(e,a);const u=new DataView(i.buffer),h=kn(Ir(u,0,u.byteLength),s,t);return Ar(u,0,h,!1),i}var E;(function(r){r[r.Auth=1213486401]="Auth",r[r.Close=1163086915]="Close",r[r.Connect=1314410051]="Connect",r[r.Okay=1497451343]="Okay",r[r.Open=1313165391]="Open",r[r.Write=1163154007]="Write"})(E||(E={}));const Jt=new k({littleEndian:!0}).uint32("command").uint32("arg0").uint32("arg1").uint32("payloadLength").uint32("checksum").int32("magic");new k({littleEndian:!0}).concat(Jt).uint8Array("payload",{lengthField:"payloadLength"});function Ls(r){return r.reduce((e,t)=>e+t,0)}class Dn extends cs{constructor(){const e=new Uint8Array(Jt.size);super({transform:async(t,s)=>{const i=t;i.payloadLength=i.payload.byteLength,Jt.serialize(i,e),await s.enqueue(e),i.payload.byteLength&&await s.enqueue(i.payload)}})}}var Be;(function(r){r[r.Token=1]="Token",r[r.Signature=2]="Signature",r[r.PublicKey=3]="PublicKey"})(Be||(Be={}));const On=async function*(r,e){for await(const t of r.iterateKeys()){const s=await e();if(s.arg0!==Be.Token)return;const i=Ln(t.buffer,s.payload);yield{command:E.Auth,arg0:Be.Signature,arg1:0,payload:new Uint8Array(i)}}},Tn=async function*(r,e){var h;if((await e()).arg0!==Be.Token)return;let s;for await(const d of r.iterateKeys()){s=d;break}s||(s=await r.generateKey());const i=Ss(),[a]=gs(i),o=(h=s.name)!=null&&h.length?Wt(s.name):We,u=new Uint8Array(a+(o.length?o.length+1:0)+1);En(s.buffer,u),Ui(u.subarray(0,i),u),o.length&&(u[a]=32,u.set(o,a+1)),yield{command:E.Auth,arg0:Be.PublicKey,arg1:0,payload:u}},Nn=[On,Tn];var bt,Pe,we,ir,nr,Ds;class Pn{constructor(e,t){c(this,nr);w(this,"authenticators");c(this,bt,void 0);c(this,Pe,new I);c(this,we,void 0);c(this,ir,()=>n(this,Pe).promise);this.authenticators=e,l(this,bt,t)}async process(e){n(this,we)||l(this,we,p(this,nr,Ds).call(this)),n(this,Pe).resolve(e);const t=await n(this,we).next();if(t.done)throw new Error("No authenticator can handle the request");return t.value}dispose(){var e,t;(t=(e=n(this,we))==null?void 0:e.return)==null||t.call(e)}}bt=new WeakMap,Pe=new WeakMap,we=new WeakMap,ir=new WeakMap,nr=new WeakSet,Ds=async function*(){for(const e of this.authenticators)for await(const t of e(n(this,bt),n(this,ir)))l(this,Pe,new I),yield t};var pe,mt,K,vt,Et,kt,_t,Re,j,ar,Os;class rs{constructor(e){c(this,ar);c(this,pe,void 0);w(this,"localId");w(this,"remoteId");w(this,"localCreated");w(this,"service");c(this,mt,void 0);c(this,K,void 0);c(this,vt,void 0);w(this,"writable");c(this,Et,!1);c(this,kt,new I);c(this,_t,void 0);c(this,Re,void 0);c(this,j,0);l(this,pe,e.dispatcher),this.localId=e.localId,this.remoteId=e.remoteId,this.localCreated=e.localCreated,this.service=e.service,l(this,mt,new Fe(t=>{l(this,K,t)})),this.writable=new Q({start:t=>{l(this,vt,t)},write:async(t,s)=>{const i=t.length,a=n(this,pe).options.maxPayloadSize;for(let o=0,u=a;o<i;o=u,u+=a){const h=t.subarray(o,u);await p(this,ar,Os).call(this,h,s.signal)}}}),l(this,_t,new Rn(this))}get readable(){return n(this,mt)}get closed(){return n(this,kt).promise}get socket(){return n(this,_t)}async enqueue(e){if(!n(this,K).abortSignal.aborted)try{await n(this,K).enqueue(e)}catch(t){if(n(this,K).abortSignal.aborted)return;throw t}}ack(e){var t;l(this,j,n(this,j)+e),(t=n(this,Re))==null||t.resolve()}async close(){var e;if(!n(this,Et)){l(this,Et,!0),(e=n(this,Re))==null||e.reject(new Error("Socket closed"));try{n(this,vt).error(new Error("Socket closed"))}catch{}await n(this,pe).sendPacket(E.Close,this.localId,this.remoteId)}}dispose(){try{n(this,K).close()}catch{}n(this,kt).resolve()}}pe=new WeakMap,mt=new WeakMap,K=new WeakMap,vt=new WeakMap,Et=new WeakMap,kt=new WeakMap,_t=new WeakMap,Re=new WeakMap,j=new WeakMap,ar=new WeakSet,Os=async function(e,t){const s=e.byteLength;for(;n(this,j)<s;){const i=new I;t.addEventListener("abort",()=>{i.reject(t.reason)}),l(this,Re,i),await i.promise}n(this,j)===1/0?l(this,j,-1):l(this,j,n(this,j)-s),await n(this,pe).sendPacket(E.Write,this.localId,this.remoteId,e)};var O;class Rn{constructor(e){c(this,O,void 0);l(this,O,e)}get localId(){return n(this,O).localId}get remoteId(){return n(this,O).remoteId}get localCreated(){return n(this,O).localCreated}get service(){return n(this,O).service}get readable(){return n(this,O).readable}get writable(){return n(this,O).writable}get closed(){return n(this,O).closed}close(){return n(this,O).close()}}O=new WeakMap;var G,P,ge,xt,ze,ye,St,or,Ts,cr,Ns,Lt,Fr,lr,Ps,ur,Rs,Dt,Br;class zn{constructor(e,t){c(this,or);c(this,cr);c(this,Lt);c(this,lr);c(this,ur);c(this,Dt);c(this,G,new ri(1));c(this,P,new Map);c(this,ge,void 0);w(this,"options");c(this,xt,!1);c(this,ze,new I);c(this,ye,new Map);c(this,St,new wr);this.options=t,this.options.initialDelayedAckBytes<0&&(this.options.initialDelayedAckBytes=0),e.readable.pipeTo(new Z({write:async s=>{switch(s.command){case E.Close:await p(this,or,Ts).call(this,s);break;case E.Okay:p(this,cr,Ns).call(this,s);break;case E.Open:await p(this,lr,Ps).call(this,s);break;case E.Write:await p(this,ur,Rs).call(this,s);break;default:throw new Error(`Unknown command: ${s.command.toString(16)}`)}}}),{preventCancel:t.preserveConnection??!1,signal:n(this,St).signal}).then(()=>{p(this,Dt,Br).call(this)},s=>{n(this,xt)||n(this,ze).reject(s),p(this,Dt,Br).call(this)}),l(this,ge,e.writable.getWriter())}get disconnected(){return n(this,ze).promise}async createSocket(e){this.options.appendNullToServiceString&&(e+="\0");const[t,s]=n(this,G).add();await this.sendPacket(E.Open,t,this.options.initialDelayedAckBytes,e);const{remoteId:i,availableWriteBytes:a}=await s,o=new rs({dispatcher:this,localId:t,remoteId:i,localCreated:!0,service:e});return o.ack(a),n(this,P).set(t,o),o.socket}addReverseTunnel(e,t){n(this,ye).set(e,t)}removeReverseTunnel(e){n(this,ye).delete(e)}clearReverseTunnels(){n(this,ye).clear()}async sendPacket(e,t,s,i=We){if(typeof i=="string"&&(i=Wt(i)),i.byteLength>this.options.maxPayloadSize)throw new Error("payload too large");await Q.write(n(this,ge),{command:e,arg0:t,arg1:s,payload:i,checksum:this.options.calculateChecksum?Ls(i):0,magic:e^4294967295})}async close(){await Promise.all(Array.from(n(this,P).values(),e=>e.close())),l(this,xt,!0),n(this,St).abort(),this.options.preserveConnection?n(this,ge).releaseLock():await n(this,ge).close()}}G=new WeakMap,P=new WeakMap,ge=new WeakMap,xt=new WeakMap,ze=new WeakMap,ye=new WeakMap,St=new WeakMap,or=new WeakSet,Ts=async function(e){if(e.arg0===0&&n(this,G).reject(e.arg1,new Error("Socket open failed")))return;const t=n(this,P).get(e.arg1);if(t){await t.close(),t.dispose(),n(this,P).delete(e.arg1);return}},cr=new WeakSet,Ns=function(e){let t;if(this.options.initialDelayedAckBytes!==0){if(e.payload.byteLength!==4)throw new Error("Invalid OKAY packet. Payload size should be 4");t=ee.Uint32.deserialize(e.payload,!0)}else{if(e.payload.byteLength!==0)throw new Error("Invalid OKAY packet. Payload size should be 0");t=1/0}if(n(this,G).resolve(e.arg1,{remoteId:e.arg0,availableWriteBytes:t}))return;const s=n(this,P).get(e.arg1);if(s){s.ack(t);return}this.sendPacket(E.Close,e.arg1,e.arg0)},Lt=new WeakSet,Fr=function(e,t,s){let i;return this.options.initialDelayedAckBytes!==0?(i=new Uint8Array(4),new DataView(i.buffer).setUint32(0,s,!0)):i=We,this.sendPacket(E.Okay,e,t,i)},lr=new WeakSet,Ps=async function(e){const[t]=n(this,G).add();n(this,G).resolve(t,void 0);const s=e.arg0;let i=e.arg1;const a=Ct(e.payload);if(this.options.initialDelayedAckBytes===0){if(i!==0)throw new Error("Invalid OPEN packet. arg1 should be 0");i=1/0}else if(i===0)throw new Error("Invalid OPEN packet. arg1 should be greater than 0");const o=n(this,ye).get(a);if(!o){await this.sendPacket(E.Close,0,s);return}const u=new rs({dispatcher:this,localId:t,remoteId:s,localCreated:!1,service:a});u.ack(i);try{await o(u.socket),n(this,P).set(t,u),await p(this,Lt,Fr).call(this,t,s,this.options.initialDelayedAckBytes)}catch{await this.sendPacket(E.Close,0,s)}},ur=new WeakSet,Rs=async function(e){const t=n(this,P).get(e.arg1);if(!t)throw new Error(`Unknown local socket id: ${e.arg1}`);let s=!1;await Promise.race([xi(5e3).then(()=>{if(this.options.debugSlowRead&&!s)throw new Error(`packet for \`${t.service}\` not handled in 5 seconds`)}),(async()=>{await t.enqueue(e.payload),await p(this,Lt,Fr).call(this,e.arg1,e.arg0,e.payload.length),s=!0})()])},Dt=new WeakSet,Br=function(){for(const e of n(this,P).values())e.dispose();n(this,ze).resolve()};const In=16777217,ss=[g.ShellV2,g.Cmd,g.StatV2,g.ListV2,g.FixedPushMkdir,"apex",g.Abb,"fixed_push_symlink_timestamp",g.AbbExec,"remount_shell","track_app",g.SendReceiveV2,"sendrecv_v2_brotli","sendrecv_v2_lz4","sendrecv_v2_zstd","sendrecv_v2_dry_run_send",g.DelayedAck],is=32*1024*1024;var Ot,R,Tt,Nt,Ie,Pt;const jr=class jr{constructor({serial:e,connection:t,version:s,banner:i,features:a=ss,initialDelayedAckBytes:o=is,...u}){c(this,Ot,void 0);c(this,R,void 0);c(this,Tt,void 0);c(this,Nt,void 0);c(this,Ie,void 0);c(this,Pt,void 0);if(l(this,Tt,e),l(this,Ot,t),l(this,Ie,zr.parse(i)),l(this,Pt,a),a.includes(g.DelayedAck)){if(o<=0)throw new Error("`initialDelayedAckBytes` must be greater than 0 when DelayedAck feature is enabled.");n(this,Ie).features.includes(g.DelayedAck)||(o=0)}else o=0;let h,d;s>=In?(h=!1,d=!1):(h=!0,d=!0),l(this,R,new zn(t,{calculateChecksum:h,appendNullToServiceString:d,initialDelayedAckBytes:o,...u})),l(this,Nt,s)}static async authenticate({serial:e,connection:t,credentialStore:s,authenticators:i=Nn,features:a=ss,initialDelayedAckBytes:o=is,...u}){let h=16777217,d=1024*1024;const y=new I,f=new Pn(i,s),Ue=new wr,Ve=t.readable.pipeTo(new Z({async write(b){switch(b.command){case E.Connect:h=Math.min(h,b.arg0),d=Math.min(d,b.arg1),y.resolve(Ct(b.payload));break;case E.Auth:{const Vs=await f.process(b);await J(Vs);break}}}}),{preventCancel:!0,signal:Ue.signal}).then(()=>{y.state==="running"&&y.reject(new Error("Connection closed unexpectedly"))},b=>{y.reject(b)}),me=t.writable.getWriter();async function J(b){b.checksum=Ls(b.payload),b.magic=b.command^4294967295,await Q.write(me,b)}const Ce=a.slice();if(o<=0){const b=a.indexOf(g.DelayedAck);b!==-1&&Ce.splice(b,1)}let $t;try{await J({command:E.Connect,arg0:h,arg1:d,payload:Wt(`host::features=${Ce.join(",")}`)}),$t=await y.promise}finally{Ue.abort(),me.releaseLock(),await Ve}return new jr({serial:e,connection:t,version:h,maxPayloadSize:d,banner:$t,features:Ce,initialDelayedAckBytes:o,...u})}get connection(){return n(this,Ot)}get serial(){return n(this,Tt)}get protocolVersion(){return n(this,Nt)}get maxPayloadSize(){return n(this,R).options.maxPayloadSize}get banner(){return n(this,Ie)}get disconnected(){return n(this,R).disconnected}get clientFeatures(){return n(this,Pt)}connect(e){return n(this,R).createSocket(e)}addReverseTunnel(e,t){return t||(t=`localabstract:reverse_${Math.random().toString().substring(2)}`),n(this,R).addReverseTunnel(t,e),t}removeReverseTunnel(e){n(this,R).removeReverseTunnel(e)}clearReverseTunnels(){n(this,R).clearReverseTunnels()}close(){return n(this,R).close()}};Ot=new WeakMap,R=new WeakMap,Tt=new WeakMap,Nt=new WeakMap,Ie=new WeakMap,Pt=new WeakMap;let Ur=jr;g.ShellV2,g.Cmd,g.StatV2,g.ListV2,g.FixedPushMkdir,g.Abb,g.AbbExec,g.SendReceiveV2;function zs(r,e){return typeof r=="object"&&r!==null&&"name"in r&&r.name===e}function An(r,e){return e.some(t=>r.interfaceClass===t.classCode&&r.interfaceSubclass===t.subclassCode&&r.interfaceProtocol===t.protocolCode)}function Is(r,e){for(const t of r.configurations)for(const s of t.interfaces)for(const i of s.alternates)if(An(i,e))return{configuration:t,interface_:s,alternate:i};throw new Error("No matched alternate interface found")}function ns(r){return r.toString(16).padStart(4,"0")}function As(r){return r.serialNumber?r.serialNumber:ns(r.vendorId)+"x"+ns(r.productId)}const Vr={classCode:255,subclassCode:66,protocolCode:1};function Fn(r){if(r.length===0)throw new Error("No endpoints given");let e,t;for(const s of r)switch(s.direction){case"in":if(e=s,t)return{inEndpoint:e,outEndpoint:t};break;case"out":if(t=s,e)return{inEndpoint:e,outEndpoint:t};break}throw e?t?new Error("unreachable"):new Error("No output endpoint found."):new Error("No input endpoint found.")}var Rt,H;class Bn{constructor(e){c(this,Rt,void 0);c(this,H,void 0);l(this,Rt,e),l(this,H,0)}get position(){return n(this,H)}readExactly(e){const t=n(this,Rt).subarray(n(this,H),n(this,H)+e);return l(this,H,n(this,H)+e),t}}Rt=new WeakMap,H=new WeakMap;var be,Y,zt,It,At,hr,Fs;class Un{constructor(e,t,s,i){c(this,hr);c(this,be,void 0);c(this,Y,void 0);c(this,zt,void 0);c(this,It,void 0);c(this,At,void 0);l(this,be,e),l(this,Y,t),l(this,zt,s);let a=!1;const o=new Oi({close:async()=>{try{a=!0,await e.raw.close()}catch{}},dispose:()=>{a=!0,i.removeEventListener("disconnect",u)}});function u(d){d.device===e.raw&&o.dispose().catch(ys)}i.addEventListener("disconnect",u),l(this,It,o.wrapReadable(new Vt({pull:async d=>{const y=await p(this,hr,Fs).call(this);y?d.enqueue(y):d.close()}},{highWaterMark:0})));const h=s.packetSize-1;l(this,At,Ti(o.createWritable(new Q({write:async d=>{try{await e.raw.transferOut(s.endpointNumber,d),h&&!(d.byteLength&h)&&await e.raw.transferOut(s.endpointNumber,We)}catch(y){if(a)return;throw y}}})),new Dn))}get device(){return n(this,be)}get inEndpoint(){return n(this,Y)}get outEndpoint(){return n(this,zt)}get readable(){return n(this,It)}get writable(){return n(this,At)}}be=new WeakMap,Y=new WeakMap,zt=new WeakMap,It=new WeakMap,At=new WeakMap,hr=new WeakSet,Fs=async function(){try{for(;;){const e=await n(this,be).raw.transferIn(n(this,Y).endpointNumber,n(this,Y).packetSize);if(e.data.byteLength!==24)continue;const t=new Uint8Array(e.data.buffer),s=new Bn(t),i=Jt.deserialize(s);if(i.magic===(i.command^4294967295)){if(i.payloadLength!==0){const a=await n(this,be).raw.transferIn(n(this,Y).endpointNumber,i.payloadLength);i.payload=new Uint8Array(a.data.buffer)}else i.payload=We;return i}}}catch(e){if(zs(e,"NetworkError")){if(await new Promise(t=>{setTimeout(()=>{t()},100)}),closed)return;throw e}throw e}};var Ft,Bt,x,Ut,dr,Bs;class as{constructor(e,t=[Vr],s){c(this,dr);c(this,Ft,void 0);c(this,Bt,void 0);c(this,x,void 0);c(this,Ut,void 0);l(this,x,e),l(this,Ut,As(e)),l(this,Ft,t),l(this,Bt,s)}get raw(){return n(this,x)}get serial(){return n(this,Ut)}get name(){return n(this,x).productName}async connect(){const[e,t]=await p(this,dr,Bs).call(this);return new Un(this,e,t,n(this,Bt))}}Ft=new WeakMap,Bt=new WeakMap,x=new WeakMap,Ut=new WeakMap,dr=new WeakSet,Bs=async function(){var o;n(this,x).opened||await n(this,x).open();const{configuration:e,interface_:t,alternate:s}=Is(n(this,x),n(this,Ft));((o=n(this,x).configuration)==null?void 0:o.configurationValue)!==e.configurationValue&&await n(this,x).selectConfiguration(e.configurationValue),t.claimed||await n(this,x).claimInterface(t.interfaceNumber),t.alternate.alternateSetting!==s.alternateSetting&&await n(this,x).selectAlternateInterface(t.interfaceNumber,s.alternateSetting);const{inEndpoint:i,outEndpoint:a}=Fn(s.endpoints);return[i,a]};var X;const fr=class fr{constructor(e){c(this,X,void 0);l(this,X,e)}async requestDevice(e={}){if(!e.filters)e.filters=[Vr];else if(e.filters.length===0)throw new TypeError("filters must not be empty");try{const t=await n(this,X).requestDevice(e);return new as(t,e.filters,n(this,X))}catch(t){if(zs(t,"NotFoundError"))return;throw t}}async getDevices(e=[Vr]){if(e.length===0)throw new TypeError("filters must not be empty");return(await n(this,X).getDevices()).filter(s=>{for(const i of e)if(!("vendorId"in i&&s.vendorId!==i.vendorId)&&!("productId"in i&&s.productId!==i.productId)&&!("serialNumber"in i&&As(s)!==i.serialNumber))try{return Is(s,e),!0}catch{continue}return!1}).map(s=>new as(s,e,n(this,X)))}};X=new WeakMap,w(fr,"BROWSER",typeof globalThis.navigator<"u"&&globalThis.navigator.usb?new fr(globalThis.navigator.usb):void 0);let er=fr;function Us(){return new Promise((r,e)=>{const t=indexedDB.open("Tango",1);t.onerror=()=>{e(t.error)},t.onupgradeneeded=()=>{t.result.createObjectStore("Authentication",{autoIncrement:!0})},t.onsuccess=()=>{const s=t.result;r(s)}})}async function Vn(r){const e=await Us();return new Promise((t,s)=>{const i=e.transaction("Authentication","readwrite"),o=i.objectStore("Authentication").add(r);o.onerror=()=>{s(o.error)},o.onsuccess=()=>{t()},i.onerror=()=>{s(i.error)},i.oncomplete=()=>{e.close()}})}async function Cn(){const r=await Us();return new Promise((e,t)=>{const s=r.transaction("Authentication","readonly"),a=s.objectStore("Authentication").getAll();a.onerror=()=>{t(a.error)},a.onsuccess=()=>{e(a.result)},s.onerror=()=>{t(s.error)},s.oncomplete=()=>{r.close()}})}var Ae;class Wn{constructor(e="Tango"){c(this,Ae,void 0);l(this,Ae,e)}async generateKey(){const{privateKey:e}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-1"},!0,["sign","verify"]),t=new Uint8Array(await crypto.subtle.exportKey("pkcs8",e));return await Vn(t),{buffer:t,name:`${n(this,Ae)}@${globalThis.location.hostname}`}}async*iterateKeys(){for(const e of await Cn())yield{buffer:e,name:`${n(this,Ae)}@${globalThis.location.hostname}`}}}Ae=new WeakMap;const Mn=ls({__name:"index",setup(r){const e=us(!0),t=ci(),s=li(()=>t.name||"FileManager");return(i,a)=>{const o=Ms,u=ai,h=oi;return qt(),hs(h,{"default-active":se(s),collapse:se(e),router:!0},{default:A(()=>[z(u,{index:"FileManager",route:{name:"FileManager"}},{title:A(()=>[Er("")]),default:A(()=>[z(o,null,{default:A(()=>[z(se($s))]),_:1})]),_:1}),z(u,{index:"ADBRunner",route:{name:"ADBRunner"}},{title:A(()=>[Er("ADB")]),default:A(()=>[z(o,null,{default:A(()=>[z(se(ni))]),_:1})]),_:1})]),_:1},8,["default-active","collapse"])}}}),$n={class:"flex flex-col h-full w-full p-2 overflow-hidden"},qn={class:"flex items-center"},Kn=kr("span",{style:{color:"var(--el-text-color-regular)"}},"  ",-1),jn={class:"font-600 text-large mr-3"},Gn={key:0,class:"flex flex-1 h-0 my-2 overflow-hidden"},ha=ls({__name:"index",setup(r){const e=gi(ii),t=()=>{const f=er.BROWSER;return f?f.requestDevice({}):Promise.reject("WebUsb")},s=()=>{const f=er.BROWSER;return f?f.getDevices():Promise.reject("WebUsb")},i=ui(),a=()=>{i.push("/")};let o=null;fi("getAdb",()=>o);const u=hi({name:"",serial:""}),h=async f=>{var J;if(f.raw.opened)return yi.info("");o&&((J=o.close)==null||J.call(o)),u.name=f.name,u.serial=f.serial;const Ue=await f.connect(),Ve=new Wn,me=await Ur.authenticate({serial:f.serial,connection:Ue,credentialStore:Ve});o=new pn(me),e.emit()},d=us(!1),y=async()=>{const f=await t();f&&(d.value=!0,await h(f).finally(()=>{d.value=!1}))};return di(async()=>{const f=await s();f!=null&&f[0]&&await h(f[0])}),(f,Ue)=>{var b;const Ve=Gs,me=Ks,J=js,Ce=wi("router-view"),$t=qs;return qt(),Yr("div",$n,[kr("div",qn,[z(me,{onBack:a},{title:A(()=>[Kn]),content:A(()=>[kr("code",jn,pi(se(u).name||""),1),z(Ve,{type:"primary",loading:se(d),text:"",onClick:y},{default:A(()=>[Er("")]),_:1},8,["loading"])]),_:1})]),z(J,{class:"!mt-4 !mb-1"}),(b=se(u))!=null&&b.name?(qt(),Yr("div",Gn,[z(Mn),z(Ce)])):(qt(),hs($t,{key:1,description:"",class:"flex-1"}))])}}});export{ha as default};
